<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚«ãƒ‹ã‚²ãƒ¼ãƒ </title>
  <style>
    /* ã‚²ãƒ¼ãƒ ç”»é¢ã®ç®± */
    #game {
      position: relative;
      width: 360px;
      height: 640px;
      margin: 0 auto;
      background: #cce8ff; /* æ°´è‰²ï¼æµ·ã£ã½ã„ */
      overflow: hidden;
      touch-action: none; /* ã‚²ãƒ¼ãƒ é ˜åŸŸã§ã®æ¨™æº–ã‚¸ã‚§ã‚¹ãƒãƒ£ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã©ï¼‰ã‚’ç„¡åŠ¹åŒ– */
    }

    /* ã‚«ãƒ‹ */
    #crab {
      position: absolute;
      bottom: 100px; /* ä¿®æ­£: ã‚¿ãƒƒãƒãƒœã‚¿ãƒ³ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ */
      left: 50%;
      transform: translateX(-50%);
      font-size: 40px;
    }

    /* çˆ†å¼¾ï¼ˆè¤‡æ•°ï¼‰ */
    .bomb {
      position: absolute;
      top: -40px;
      left: 160px;
      font-size: 40px;
    }

    /* çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆèµ¤ã„ä¸¸ãŒãƒãƒ³ã£ã¨åºƒãŒã‚‹ï¼‰ */
    .explosion {
      position: absolute;
      width: 20px;
      height: 20px;
      background: red;
      border-radius: 50%;
      transform: translate(-50%, -50%) scale(0.2);
      opacity: 1;
      pointer-events: none;
      animation: boom 0.4s ease-out forwards;
    }

    @keyframes boom {
      0% {
        transform: translate(-50%, -50%) scale(0.2);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(3.0);
        opacity: 0;
      }
    }

    /* ğŸ† ã‚¹ã‚³ã‚¢è¡¨ç¤ºã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #333;
      font-size: 20px;
      font-weight: bold;
      z-index: 10;
    }

    /* ğŸ›‘ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #game-over-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7); /* åŠé€æ˜ã®é»’ */
      color: white;
      
      display: none; 
      
      z-index: 20;
      
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    #game-over-screen h2 {
      font-size: 40px;
      margin-bottom: 10px;
    }

    #game-over-screen p {
      font-size: 24px;
      margin-bottom: 30px;
    }

    #game-over-screen button {
      padding: 10px 20px;
      font-size: 20px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background: #ffcc00;
      color: #333;
      font-weight: bold;
      transition: background 0.2s;
    }
    
    #game-over-screen button:hover {
        background: #ffe066;
    }

    /* âœ¨ çŒ«ã‚²ãƒƒãƒˆæ™‚ã®ã‚­ãƒ©ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .collect-effect {
      position: absolute;
      width: 30px;
      height: 30px;
      background: #ffd700; /* é‡‘è‰²ã£ã½ã„è‰² */
      border-radius: 50%;
      transform: translate(-50%, -50%) scale(0.1);
      opacity: 1;
      pointer-events: none;
      animation: sparkle 0.6s ease-out forwards; /* 0.6ç§’ã§å‹•ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
      box-shadow: 0 0 10px 5px rgba(255, 215, 0, 0.7); /* å…‰ã£ã¦ã‚‹æ„Ÿã˜ */
    }

    @keyframes sparkle {
      0% {
        transform: translate(-50%, -50%) scale(0.1);
        opacity: 1;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.5); /* ä¸­é–“ã§å¤§ãããªã‚‹ */
        opacity: 0.8;
      }
      100% {
        transform: translate(-50%, -50%) scale(0.5); /* æ¶ˆãˆã‚‹å‰ã«å°‘ã—å°ã•ã */
        opacity: 0;
      }
    }
    
    /* ğŸ“± ã‚¹ãƒãƒ›ç”¨æ“ä½œãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #controls {
      position: absolute;
      bottom: 0px;
      width: 100%;
      height: 80px; /* ãƒœã‚¿ãƒ³ã®é«˜ã• */
      display: flex;
      justify-content: space-around; /* å·¦å³å‡ç­‰ã«é…ç½® */
      align-items: center;
      padding: 10px;
      box-sizing: border-box;
      z-index: 15;
      background: #eee; /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã®èƒŒæ™¯ã‚’åŒºåˆ¥ã—ã‚„ã™ã */
      border-top: 2px solid #aaa;
    }
    #controls button {
      width: 45%;
      height: 60px;
      font-size: 30px;
      background: #fff;
      border: 3px solid #333;
      border-radius: 10px;
      cursor: pointer;
      user-select: none; /* ã‚¿ãƒƒãƒ—æ™‚ã«é’ããªã‚‹ã®ã‚’é˜²ã */
      touch-action: manipulation; /* ã‚¿ãƒƒãƒ—é…å»¶ã‚’é˜²ã */
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="score">ç”Ÿãæ®‹ã£ãŸæ™‚é–“: 0.00s</div>
    <div id="crab">ğŸ¦€</div>
    
    <div id="controls">
      <button id="left-btn">â—€</button>
      <button id="right-btn">â–¶</button>
    </div>
    <div id="game-over-screen">
      <h2>GAME OVER</h2>
      <p id="final-score"></p>
      <button onclick="window.location.reload()">ã‚‚ã†ä¸€åº¦éŠã¶</button>
    </div>
  </div>

  <script>
    const gameWidth = 360;
    const gameHeight = 640;

    const game = document.getElementById('game');
    const crab = document.getElementById('crab');
    const scoreEl = document.getElementById('score');
    
    const gameOverScreen = document.getElementById('game-over-screen');
    const finalScoreEl = document.getElementById('final-score');
    
    gameOverScreen.style.display = 'none';

    let crabX = gameWidth / 2;
    const crabSpeed = 6;
    
    crab.style.left = crabX + 'px';

    // çˆ†å¼¾ã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã™ã‚‹é…åˆ—
    const bombs = [];
    let frameCount = 0;
    let leftPressed = false;
    let rightPressed = false;
    let running = true;

    // çˆ†å¼¾ã‚’1å€‹ç”Ÿæˆã™ã‚‹é–¢æ•°
    function spawnBomb() {
      const el = document.createElement('div');
      el.className = 'bomb';
      
      const isCat = Math.random() < 0.1;
      el.textContent = isCat ? 'ğŸ±' : 'ğŸ’£';
      const type = isCat ? 'cat' : 'bomb';

      const x = Math.random() * (gameWidth - 40);
      const y = -40;
      // ğŸ± çŒ«ã¯çˆ†å¼¾ã‚ˆã‚Šã‚‚é€Ÿãï¼ˆ4.0ã€œ6.0ï¼‰è½ã¡ã‚‹
      const speed = isCat ? 4 + Math.random() * 2 : 3 + Math.random() * 1.5; 

      el.style.left = x + 'px';
      el.style.top = y + 'px';
      game.appendChild(el);

      bombs.push({ x, y, speed, el, type });
    }

    // èµ¤ã„å††ã®çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    function createExplosion(x, y) {
      const ex = document.createElement('div');
      ex.className = 'explosion';
      ex.style.left = x + 'px';
      ex.style.top = y + 'px';
      game.appendChild(ex);

      setTimeout(() => {
        ex.remove();
      }, 400);
    }

    // âœ¨ çŒ«ã‚²ãƒƒãƒˆæ™‚ã®ã‚­ãƒ©ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    function createCollectEffect(x, y) {
      const effect = document.createElement('div');
      effect.className = 'collect-effect';
      effect.style.left = x + 'px';
      effect.style.top = y + 'px';
      game.appendChild(effect);

      setTimeout(() => {
        effect.remove();
      }, 600);
    }


    function loop() {
      if (!running) return;
      frameCount++;

      let score = (frameCount / 60);
      scoreEl.textContent = `ç”Ÿãæ®‹ã£ãŸæ™‚é–“: ${score.toFixed(2)}s`;

      if (leftPressed) {
        crabX -= crabSpeed;
      }
      if (rightPressed) {
        crabX += crabSpeed;
      }

      // ã‚«ãƒ‹ã®ç§»å‹•åˆ¶é™ï¼ˆç”»é¢ç«¯ï¼‰
      const minX = 30;
      const maxX = gameWidth - 30;
      if (crabX < minX) crabX = minX;
      if (crabX > maxX) crabX = maxX;

      crab.style.left = crabX + 'px';

      // çˆ†å¼¾ã®ç”Ÿæˆé »åº¦
      if (frameCount % 60 === 0) {
        spawnBomb();
      }

      // çˆ†å¼¾ã®è½ä¸‹ã¨ç”»é¢å¤–åˆ¤å®š
      for (let i = bombs.length - 1; i >= 0; i--) {
        const bomb = bombs[i];
        bomb.y += bomb.speed;
        bomb.el.style.top = bomb.y + 'px';

        if (bomb.y > gameHeight + 40) {
          bomb.el.remove();
          bombs.splice(i, 1);
          continue;
        }
      }

      // è¡çªåˆ¤å®š
      const crabRect = crab.getBoundingClientRect();
      const OFFSET = 10; 

      for (let i = bombs.length - 1; i >= 0; i--) {
        const item = bombs[i];
        const itemRect = item.el.getBoundingClientRect();

        const hit =
          crabRect.left + OFFSET < itemRect.right && 
          crabRect.right - OFFSET > itemRect.left && 
          crabRect.top + OFFSET < itemRect.bottom && 
          crabRect.bottom - OFFSET > itemRect.top; 

        if (hit) {
          if (item.type === 'cat') {
            // çŒ«ã‚²ãƒƒãƒˆï¼
            item.el.remove();
            bombs.splice(i, 1);
            frameCount += 60 * 5; // ã‚¹ã‚³ã‚¢ï¼‹5ç§’
            console.log("CAT GET! Score +5s!");
            
            createCollectEffect(item.x + item.el.offsetWidth / 2, item.y + item.el.offsetHeight / 2);
            
          } else {
            // çˆ†å¼¾ãƒ’ãƒƒãƒˆï¼ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
            running = false;
            createExplosion(crabX, crabRect.top); // çˆ†ç™ºä½ç½®ã‚’ã‚«ãƒ‹ã®ä¸­å¿ƒã«
            crab.style.display = 'none';

            for (const b of bombs) {
              b.el.remove();
            }

            console.log("HIT!!");
            
            const finalScore = (frameCount / 60).toFixed(2);
            gameOverScreen.style.display = 'flex'; 
            finalScoreEl.textContent = `è¨˜éŒ²: ${finalScore}ç§’`;
            
            return;
          }
        }
      }

      requestAnimationFrame(loop);
    }

    requestAnimationFrame(loop);

    // ===================================
    // ğŸ•¹ï¸ PCï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼‰æ“ä½œã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    // ===================================

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        leftPressed = true;
      }
      if (e.key === 'ArrowRight') {
        rightPressed = true;
      }
    });

    document.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft') {
        leftPressed = false;
      }
      if (e.key === 'ArrowRight') {
        rightPressed = false;
      }
    });
    
    // ===================================
    // ğŸ“± ã‚¿ãƒƒãƒæ“ä½œï¼ˆãƒœã‚¿ãƒ³ï¼‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    // ===================================

    const leftBtn = document.getElementById('left-btn');
    const rightBtn = document.getElementById('right-btn');

    // **PC (Mouse) & Touchå…±é€šã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©**
    
    function startMoveLeft(e) {
      e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã©ã‚’é˜²ã
      leftPressed = true;
    }

    function stopMoveLeft() {
      leftPressed = false;
    }

    function startMoveRight(e) {
      e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã©ã‚’é˜²ã
      rightPressed = true;
    }

    function stopMoveRight() {
      rightPressed = false;
    }

    // å·¦ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
    leftBtn.addEventListener('mousedown', startMoveLeft);
    leftBtn.addEventListener('mouseup', stopMoveLeft);
    leftBtn.addEventListener('mouseleave', stopMoveLeft); // ãƒœã‚¿ãƒ³å¤–ã§é›¢ã—ãŸå ´åˆ
    leftBtn.addEventListener('touchstart', startMoveLeft);
    leftBtn.addEventListener('touchend', stopMoveLeft);

    // å³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
    rightBtn.addEventListener('mousedown', startMoveRight);
    rightBtn.addEventListener('mouseup', stopMoveRight);
    rightBtn.addEventListener('mouseleave', stopMoveRight); // ãƒœã‚¿ãƒ³å¤–ã§é›¢ã—ãŸå ´åˆ
    rightBtn.addEventListener('touchstart', startMoveRight);
    rightBtn.addEventListener('touchend', stopMoveRight);

  </script>
</body>
</html>